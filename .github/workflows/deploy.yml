name: Deploy WordPress Theme to cPanel via HTTPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Theme
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass rsync

      - name: Build Assets
        run: |
          npm install
          npm run build
          composer install

      - name: Sync Built Theme via SCP
        env:
          SSHPASS: "}JMpBC!qCtc,"
        run: |
          THEME_DIR="hdm-theme-tailwindcss"
          HOST="hdmarketingae@95.216.200.94"
          HOST_PATH="/home/hdmarketingae/public_html/new/wp-content/themes"

          echo "ğŸ“¦ Ø§Ù†ØªÙ‚Ø§Ù„ ØªÙ… Ø¨Ø§ scp..."
          sshpass -e scp -P 6985 -o StrictHostKeyChecking=no -r \
            -o UserKnownHostsFile=/dev/null \
            -o LogLevel=ERROR \
            $(find . -maxdepth 1 ! -name '.git' ! -name 'node_modules' ! -name '.github' ! -name '.' ) \
            $HOST:$HOST_PATH/$THEME_DIR

          echo "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø±ÙˆÛŒ Ø³Ø±ÙˆØ±"
          sshpass -e ssh -p 6985 -o StrictHostKeyChecking=no $HOST "chown -R hdmarketingae:hdmarketingae $HOST_PATH/$THEME_DIR && chmod -R 755 $HOST_PATH/$THEME_DIR"

          echo "âœ… Deployment Ú©Ø§Ù…Ù„ Ø´Ø¯!"

# Ù†Ú©Ø§Øª:
#   - Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡ Ùˆ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒÚ©Ù†Ø¯
#   - Ø­Ø°Ù clone Ùˆ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø§ rsync Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÙˆØ´Ù‡ Ú©Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ (ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡)
#   - Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ .git, node_modules, .github Ù…Ù†ØªÙ‚Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (exclude Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯)
#   - ÙÙ‚Ø· ØªÙ… ÙØ¹Ù„ÛŒ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ø¯Ø± Ù…Ø³ÛŒØ± Ù„ÙˆÚ©Ø§Ù„ Ø¯Ù‚ÛŒÙ‚Ø§ ØªÙ… Ù‚Ø±Ø§Ø± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯!
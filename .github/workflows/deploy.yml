name: Deploy WordPress Theme to cPanel via SSH

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Theme
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install sshpass
        run: sudo apt-get update && sudo apt-get install -y sshpass

      - name: Test SSH Connection
        run: |
          sshpass -p "}JMpBC!qCtc," ssh -p 6985 -o StrictHostKeyChecking=no \
            hdmarketingae@95.216.200.94 "echo ✅ SSH connection successful"

      - name: Deploy Theme and Build Assets
        run: |
          sshpass -p "}JMpBC!qCtc," ssh -p 6985 -o StrictHostKeyChecking=no \
            hdmarketingae@95.216.200.94 << 'EOF'

              echo "✅ ورود به مسیر تم وردپرس"
              cd /home/hdmarketingae/public_html/new/wp-content/themes/hdm-theme-tailwindcss/

              echo "🔁 ست کردن ریموت گیت و گرفتن آخرین تغییرات"
              git remote set-url origin git@github.com:Drlaravel/saman.git
              ssh-keyscan github.com >> ~/.ssh/known_hosts 2>/dev/null
              git fetch origin
              git reset --hard origin/main

              echo "📦 نصب پکیج‌ها و اجرای build"
              npm install
              npm run build

              echo "🔐 ست کردن دسترسی‌ها"
              chown -R hdmarketingae:hdmarketingae .
              chmod -R 755 .

              echo "🎉 Deployment completed successfully"
          EOF

  name: Deploy WordPress Theme to cPanel via HTTPS

  on:
    push:
      branches:
        - main

  jobs:
    deploy:
      name: Build & Deploy Theme
      runs-on: ubuntu-latest

      steps:
        # 1. دریافت سورس
        - name: Checkout Repository
          uses: actions/checkout@v4

        # 2. نصب Node برای build
        - name: Setup Node.js
          uses: actions/setup-node@v4
          with:
            node-version: 18

        # 3. نصب پکیج‌ها و build (روی GitHub، نه سرور)
        - name: Install dependencies & build assets
          run: |
            npm install
            npm run build

        # 4. نصب sshpass
        - name: Install sshpass
          run: sudo apt-get update && sudo apt-get install -y sshpass

        # 5. Upload theme to cPanel using scp
        - name: Upload theme to cPanel using scp
          run: |
            sshpass -p "}JMpBC!qCtc," scp -r -P 6985 \
              ./ hdmarketingae@95.216.200.94:/home/hdmarketingae/public_html/new/wp-content/themes/hdm-theme-tailwindcss

        # 6. تنظیم دسترسی‌ها (فقط روی theme)
        - name: Fix permissions on server
          run: |
            sshpass -p "}JMpBC!qCtc," ssh -p 6985 -o StrictHostKeyChecking=no \
              hdmarketingae@95.216.200.94 << 'EOF'
                chown -R hdmarketingae:hdmarketingae \
                /home/hdmarketingae/public_html/new/wp-content/themes/hdm-theme-tailwindcss

                chmod -R 755 \
                /home/hdmarketingae/public_html/new/wp-content/themes/hdm-theme-tailwindcss

                echo "✅ Deployment completed successfully"
              EOF

name: Deploy WordPress Theme to cPanel via SSH

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Theme
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install sshpass
        run: sudo apt-get update && sudo apt-get install -y sshpass

      - name: Test SSH Connection
        run: |
          sshpass -p "}JMpBC!qCtc," ssh -p 6985 -o StrictHostKeyChecking=no \
            hdmarketingae@95.216.200.94 "echo âœ… SSH connection successful"

      - name: Deploy Theme and Build Assets
        run: |
          sshpass -p "}JMpBC!qCtc," ssh -p 6985 -o StrictHostKeyChecking=no \
            hdmarketingae@95.216.200.94 << 'EOF'

              echo "âœ… ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø³ÛŒØ± ØªÙ… ÙˆØ±Ø¯Ù¾Ø±Ø³"
              cd /home/hdmarketingae/public_html/new/wp-content/themes/hdm-theme-tailwindcss/

              echo "ğŸ” Ø³Øª Ú©Ø±Ø¯Ù† Ø±ÛŒÙ…ÙˆØª Ú¯ÛŒØª Ùˆ Ú¯Ø±ÙØªÙ† Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª"
              git remote set-url origin git@github.com:Drlaravel/saman.git
              ssh-keyscan github.com >> ~/.ssh/known_hosts 2>/dev/null
              git fetch origin
              git reset --hard origin/main

              echo "ğŸ“¦ Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ build"
              npm install
              npm run build

              echo "ğŸ” Ø³Øª Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§"
              chown -R hdmarketingae:hdmarketingae .
              chmod -R 755 .

              echo "ğŸ‰ Deployment completed successfully"
          EOF
